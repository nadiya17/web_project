"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Application={storageKey:"trelloClone",save:function(){var e={columns:{idCounter:Column.idCounter,items:[]},notes:{idCounter:Note.idCounter,items:[]}};document.querySelectorAll(".column").forEach(function(t){var n={id:parseInt(t.getAttribute("data-column-id")),header:t.querySelector(".column-header").textContent,noteIds:[]};t.querySelectorAll(".note").forEach(function(e){n.noteIds.push(parseInt(e.getAttribute("data-note-id")))}),e.columns.items.push(n)}),document.querySelectorAll(".note").forEach(function(t){var n={id:parseInt(t.getAttribute("data-note-id")),content:t.textContent};e.notes.items.push(n)});var t=JSON.stringify(e);localStorage.setItem(Application.storageKey,t)},load:function(){if(localStorage.getItem(Application.storageKey)){var e=JSON.parse(localStorage.getItem(Application.storageKey)),t=document.querySelector(".columns");t.innerHTML="";var n=!0,r=!1,a=void 0;try{for(var o,i=e.columns.items[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var d=o.value,l=d.id,s=d.header,u=d.noteIds,c=new Column(l);c.element.querySelector(".column-header").textContent=s,t.append(c.element);var g=!0,m=!1,v=void 0;try{for(var f,h=u[Symbol.iterator]();!(g=(f=h.next()).done);g=!0){var p=f.value,b=function(t){return e.notes.items.find(function(e){return e.id===t})}(p),y=b.id,A=b.content,E=new Note(y,A);c.add(E)}}catch(e){m=!0,v=e}finally{try{!g&&h.return&&h.return()}finally{if(m)throw v}}}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}}}},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Column=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,e);var n=this;this.notes=[];var r=this.element=document.createElement("div");r.classList.add("column"),r.setAttribute("draggable","true"),r.setAttribute("data-column-id",t||e.idCounter++),r.innerHTML='<p class="column-header">В плане</p>\n<button class="remove-column" data-action-addRemove>X</button>\n<div data-notes></div>\n<p class="column-footer">\n    <span data-action-addNote class="action">+ Добавить карточку</span>\n</p>',r.querySelector("[data-action-addNote]").addEventListener("click",function(e){var t=new Note;n.add(t),r.querySelector("[data-notes]").append(t.element),t.element.setAttribute("contenteditable","true"),t.element.focus()}),r.querySelector("[data-action-addRemove]").addEventListener("click",function(e){r.remove(),Application.save()});var a=r.querySelector(".column-header");a.addEventListener("dblclick",function(e){r.removeAttribute("draggable"),a.setAttribute("contenteditable","true"),a.focus()}),a.addEventListener("blur",function(e){a.removeAttribute("contenteditable"),r.setAttribute("draggable","true"),Application.save()}),r.addEventListener("dragstart",this.dragstart.bind(this)),r.addEventListener("dragend",this.dragend.bind(this)),r.addEventListener("dragover",this.dragover.bind(this)),r.addEventListener("drop",this.drop.bind(this))}return _createClass(e,[{key:"add",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=!0,a=!1,o=void 0;try{for(var i,d=t[Symbol.iterator]();!(r=(i=d.next()).done);r=!0){var l=i.value;this.notes.includes(l)||(this.notes.push(l),this.element.querySelector("[data-notes]").append(l.element))}}catch(e){a=!0,o=e}finally{try{!r&&d.return&&d.return()}finally{if(a)throw o}}}},{key:"dragstart",value:function(t){t.stopPropagation(),e.dragged=this.element,this.element.classList.add("dragged"),document.querySelectorAll(".note").forEach(function(e){return e.removeAttribute("draggable")})}},{key:"dragend",value:function(t){this.element.classList.remove("dragged"),e.dragged=null,e.dropped=null,document.querySelectorAll(".note").forEach(function(e){return e.setAttribute("draggable","true")}),document.querySelectorAll(".column").forEach(function(e){return e.classList.remove("under")}),Application.save()}},{key:"dragover",value:function(t){t.preventDefault(),t.stopPropagation(),e.dragged===this.element&&(e.dropped&&e.dropped.classList.remove("under"),e.dropped=null),e.dragged&&this.element!==e.dragged&&(e.dropped=this.element,document.querySelectorAll(".column").forEach(function(e){return e.classList.remove("under")}),this.element.classList.add("under"))}},{key:"drop",value:function(t){if(t.stopPropagation(),Note.dragged)return this.element.querySelector("[data-notes]").append(Note.dragged);if(e.dragged){var n=document.querySelector(".columns"),r=Array.from(n.children);r.indexOf(this.element)<r.indexOf(e.dragged)?n.insertBefore(e.dragged,this.element):n.insertBefore(e.dragged,this.element.nextElementSibling),document.querySelectorAll(".column").forEach(function(e){return e.classList.remove("under")})}}}]),e}();Column.idCounter=4,Column.dragged=null,Column.dropped=null,$(document).ready(function(){$(document).on("click",'a[href^="#anchor"]',function(e){e.preventDefault(),$("html, body").animate({scrollTop:$($.attr(this,"href")).offset().top},1e3)})}),$("#group input:checkbox").click(function(){$(this).is(":checked")&&$("#group input:checkbox").not(this).prop("checked",!1)});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),Note=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,e);var r=this,a=this.element=document.createElement("div");a.classList.add("note"),a.setAttribute("draggable","true"),a.setAttribute("data-note-id",t||e.idCounter++),a.textContent=n,a.addEventListener("dblclick",function(e){a.removeAttribute("draggable"),r.column.removeAttribute("draggable"),a.setAttribute("contenteditable","true"),a.focus()}),a.addEventListener("blur",function(e){a.removeAttribute("contenteditable"),a.setAttribute("draggable","true"),r.column.setAttribute("draggable","true"),a.textContent.trim().length||a.remove(),Application.save()}),a.addEventListener("dragstart",this.dragstart.bind(this)),a.addEventListener("dragend",this.dragend.bind(this)),a.addEventListener("dragenter",this.dragenter.bind(this)),a.addEventListener("dragover",this.dragover.bind(this)),a.addEventListener("dragleave",this.dragleave.bind(this)),a.addEventListener("drop",this.drop.bind(this))}return _createClass(e,[{key:"dragstart",value:function(t){t.stopPropagation(),e.dragged=this.element,this.element.classList.add("dragged")}},{key:"dragend",value:function(t){t.stopPropagation(),e.dragged=null,this.element.classList.remove("dragged"),document.querySelectorAll(".note").forEach(function(e){return e.classList.remove("under")}),Application.save()}},{key:"dragenter",value:function(t){t.stopPropagation(),e.dragged&&this.element!==e.dragged&&this.element.classList.add("under")}},{key:"dragover",value:function(t){t.preventDefault(),!e.dragged||(this.element,e.dragged)}},{key:"dragleave",value:function(t){t.stopPropagation(),e.dragged&&this.element!==e.dragged&&this.element.classList.remove("under")}},{key:"drop",value:function(t){if(t.stopPropagation(),e.dragged&&this.element!==e.dragged)if(this.element.parentElement===e.dragged.parentElement){var n=Array.from(this.element.parentElement.querySelectorAll(".note")),r=n.indexOf(this.element),a=n.indexOf(e.dragged);r<a?this.element.parentElement.insertBefore(e.dragged,this.element):this.element.parentElement.insertBefore(e.dragged,this.element.nextElementSibling)}else this.element.parentElement.insertBefore(e.dragged,this.element)}},{key:"column",get:function(){return this.element.closest(".column")}}]),e}();Note.idCounter=8,Note.dragged=null,Application.load(),document.querySelector("[data-action-addColumn]").addEventListener("click",function(e){document.querySelector(".columns").append((new Column).element),Application.save()});
//# sourceMappingURL=custom-bundle.min.js.map
